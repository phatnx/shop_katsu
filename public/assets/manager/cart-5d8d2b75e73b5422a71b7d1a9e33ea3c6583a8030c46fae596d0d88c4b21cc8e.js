function Cart(t){var e=this;let r=parseFloat($("option:selected").text().split("$").pop());var o={template:{carts:$("#list-cart-template")},api:{checkout:"/api/v1/checkout",checkout_with_momo:"/api/v1/checkout_with_momo",voucher:"/api/v1/voucher",api_token:Cookies.get("api_token")},data:{}};e.settings=$.extend({},o,t),setCart=function(t){var e=JSON.stringify(t);localStorage.setItem("carts",e)},e.showBadegs=(()=>{shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$("#lblCartCount").get(0).innerText=shopping_carts&&shopping_carts.length>0?shopping_carts.length:""}),e.addToCart=function(){let t=[];t=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$(document).on("click",".add-to-cart",function(){let e;if(el=$(this).closest(".single-products"),infoProduct=el.find(".productinfo"),id_product=parseFloat(infoProduct.find(".id").attr("id")),name_product=infoProduct.find(".title").get(0).innerText,price_product=infoProduct.find(".price").get(0).innerText.replace("$",""),image_product_url=document.location.origin+infoProduct.find(".imageProduct").attr("src"),e="locale=vi"===infoProduct.find(".imageProduct").attr("src").split("?")[1]?document.location.origin+infoProduct.find(".imageProduct").attr("src").split("?")[0]+"?locale=en":image_product_url,product=t.find(t=>t.id===id_product),product)return product.quantity++,product.total_price=(product.quantity*parseFloat(price_product)).toFixed(2),setCart(t),Swal.fire({position:"top-end",icon:"success",title:"Add to cart successfully",showConfirmButton:!1,timer:1500}),t;shopping_cart={id:id_product,name_product:name_product,size_product:"S",price_product:price_product,image_product:e,quantity:1,total_price:parseFloat(price_product).toFixed(2)},t.push(shopping_cart),setCart(t),$("#lblCartCount").get(0).innerText=t.length,Swal.fire({position:"top-end",icon:"success",title:"Add to cart successfully...!",showConfirmButton:!1,timer:1500})})},getTotal=(()=>{return shopping_carts.reduce((t,e)=>t+e.price_product*e.quantity*100/100,0)}),e.showCarts=function(){shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],carts=JSON.parse(localStorage.getItem("carts")),$("#list-cart-template").length&&(template_cart=Handlebars.compile(e.settings.template.carts.html()),$(".tbody").append(template_cart({carts:carts})),$(".Cart_Sub_Total").get(0).innerText="$"+getTotal(),carts&&carts.length>0?$(".check_out").css("display","block"):$(".check_out").css("display","none"),carts&&carts.length&&(isNaN(r)&&($(".totalOrder").parent().css("display","none"),$(".shipping-cost").css("display","none")),$(".totalOrder").get(0).innerText="$"+parseFloat(r+getTotal()).toFixed(2),$("#lblCartCount").get(0).innerText=shopping_carts.length,$(".price_shipping").get(0).innerText="$"+r))},e.incrementCart=function(){$(".cart_quantity_up").off().on("click",function(){if(shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],el=$(this).closest(".cart_quantity_button"),size_product=el.closest(".list-cart").find(".size_product").find("h4").find("a").get(0).innerText,quantityInput=parseFloat(el.find(".cart_quantity_input").val()),quantityInput++,quantityInput>30)el.find(".cart_quantity_input").val(30);else if(price_product=$(this).closest(".list-cart").find(".cart_price").get(0).innerText.replace("$",""),elLiscart=$(this).closest(".list-cart").get(0),productId=parseFloat(el.parent().parent().attr("id")),product=shopping_carts.find(t=>t.id===productId&&t.size_product===size_product),product)return totalCart=0,product.quantity++,product.total_price=(quantityInput*parseFloat(price_product)).toFixed(2),el.find(".cart_quantity_input").val(quantityInput),setCart(shopping_carts),$(".Cart_Sub_Total").get(0).innerText="$"+getTotal(),$(".price_shipping").get(0).innerText="$"+r,$(".totalOrder").get(0).innerText="$"+parseFloat(r+getTotal()).toFixed(2),$(elLiscart).find(".cart_total").find(".cart_total_price").get(0).innerText="$"+(quantityInput*parseFloat(price_product)).toFixed(2),e.incrementCart(),shopping_carts})},e.decrementCart=function(){$(".cart_quantity_down").off().on("click",function(){return shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],el=$(this).closest(".cart_quantity_button"),quantityInput=parseFloat(el.find(".cart_quantity_input").val()),price_product=$(this).closest(".list-cart").find(".cart_price").get(0).innerText.replace("$",""),elLiscart=$(this).closest(".list-cart").get(0),size_product=el.closest(".list-cart").find(".size_product").find("h4").find("a").get(0).innerText,quantityInput<2?(Swal.fire({icon:"error",title:"Quantity should not be less than 1"}),void parseFloat(el.find(".cart_quantity_input").val(1))):(quantityInput--,productId=parseFloat(el.parent().parent().attr("id")),product=shopping_carts.find(t=>t.id===productId&&t.size_product===size_product),product?(totalCart=0,product.quantity--,product.total_price=(quantityInput*parseFloat(price_product)).toFixed(2),el.find(".cart_quantity_input").val(quantityInput),setCart(shopping_carts),$(".Cart_Sub_Total").get(0).innerText="$"+getTotal(),$(".price_shipping").get(0).innerText="$"+r,$(".totalOrder").get(0).innerText="$"+parseFloat(r+getTotal()).toFixed(2),$(elLiscart).find(".cart_total").find(".cart_total_price").get(0).innerText="$"+(quantityInput*parseFloat(price_product)).toFixed(2),e.decrementCart(),shopping_carts):void 0)})},e.handleQuantityInput=function(){$(".cart_quantity_input").off().on("input",function(){if(shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],el=$(this).closest(".cart_quantity_button"),quantityInput=el.find(".cart_quantity_input").val().replace(/^0+/,""),productId=parseFloat(el.parent().parent().attr("id")),price_product=$(this).closest(".list-cart").find(".cart_price").get(0).innerText.replace("$",""),elLiscart=$(this).closest(".list-cart").get(0),quantityInput<1){if(el.find(".cart_quantity_input").val(1),product=shopping_carts.find(t=>t.id===productId),product)return product.quantity=1,product.total_price=parseFloat(price_product),setCart(shopping_carts),$(".Cart_Sub_Total").get(0).innerText="$"+getTotal(),$(".totalOrder").get(0).innerText="$"+parseFloat(r+getTotal()),$(elLiscart).find(".cart_total").find(".cart_total_price").get(0).innerText="$"+parseFloat(price_product).toFixed(2),shopping_carts}else if(product=shopping_carts.find(t=>t.id===productId),product)return el.find(".cart_quantity_input").val(quantityInput),product.quantity=quantityInput,product.total_price=(quantityInput*parseFloat(price_product)).toFixed(2),setCart(shopping_carts),$(".Cart_Sub_Total").get(0).innerText="$"+getTotal(),$(".totalOrder").get(0).innerText="$"+parseFloat(r+getTotal()).toFixed(2),$(elLiscart).find(".cart_total").find(".cart_total_price").get(0).innerText="$"+(quantityInput*parseFloat(price_product)).toFixed(2),shopping_carts})},e.removeCart=function(){shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$(".cart_quantity_delete").off().on("click",function(){el=$(this).closest(".list-cart"),productId=parseFloat(el.attr("id")),size_product=el.find(".size_product").get(0).innerText,duplicate_productId=shopping_carts.filter(t=>t.id===productId),shopping_carts=shopping_carts.filter(t=>t.size_product!==size_product||t.id!==productId),setCart(shopping_carts),$(el).remove(),$("#lblCartCount").get(0).innerText=shopping_carts&&shopping_carts.length>0?shopping_carts.length:"",$(".Cart_Sub_Total").get(0).innerText="$"+getTotal(),$(".totalOrder").get(0).innerText="$"+parseFloat(r+getTotal()),e.removeCart(),shopping_carts.length<1&&e.showCarts()})},check_i18n=function(){return"/en"===window.location.pathname.substr(window.location.pathname.indexOf("/en"),3)},e.addToCartInDetail=function(){shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$(document).on("click",".add-to-cart-detail",function(){if(input=$("#numberInput").val(),locale=$(this).attr("locale"),input<0)Swal.fire({icon:"warning",title:check_i18n()||"en"==locale?"Quantity must be greater than 0":"S\u1ed1 l\u01b0\u1ee3ng ph\u1ea3i l\u1edbn h\u01a1n 0 "}).then(()=>{$("#numberInput").val(1)});else{let t;if(el=$(this).closest(".product-information"),id_product=parseFloat(el.find(".id").attr("id")),name_product=el.find(".title").get(0).innerText,quantity_product_input=parseFloat(el.find(".quantity").val()),price_product=el.find(".price").get(0).innerText.replace("USD $","").split(" ")[0],image_product_url=document.location.origin+el.closest(".product-details").find(".imageProduct").attr("src"),t="locale=vi"===el.closest(".product-details").find(".imageProduct").attr("src").split("?")[1]?document.location.origin+el.closest(".product-details").find(".imageProduct").attr("src").split("?")[0]+"?locale=en":image_product_url,size_product=$(".sprd-select__items").find(".active").get(0).innerText,isNaN(quantity_product_input))return Swal.fire({icon:"warning",title:check_i18n()||"en"==locale?"Quantity must be number":"S\u1ed1 l\u01b0\u1ee3ng ph\u1ea3i l\xe0 s\u1ed1 "}),void parseFloat(el.find(".quantity").val(1));if(product=shopping_carts.find(t=>t.id===id_product&&t.size_product===size_product),product)return product.quantity+=quantity_product_input,product.total_price=(product.quantity*parseFloat(price_product)).toFixed(2),setCart(shopping_carts),Swal.fire({position:"top-end",icon:"success",title:check_i18n()||"en"==locale?"Add to cart successfully":"Th\xeam v\xe0o gi\u1ecf h\xe0ng th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}),shopping_carts;shopping_cart={id:id_product,name_product:name_product,size_product:size_product,price_product:price_product,image_product:t,quantity:quantity_product_input,total_price:quantity_product_input*parseFloat(price_product)},shopping_carts.push(shopping_cart),setCart(shopping_carts),$("#lblCartCount").get(0).innerText=shopping_carts.length,Swal.fire({position:"top-end",icon:"success",title:check_i18n()||"en"==locale?"Add to cart successfully":"Th\xeam v\xe0o gi\u1ecf h\xe0ng th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500})}})},e.checkout=function(){shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$(".check_out").click(function(){voucher_code=$(".voucher_code").val().trim(),method_shipping=parseFloat($("option:selected").val()),$.ajax({url:e.settings.api.checkout,headers:{Authorization:"Bearer "+e.settings.api.api_token},type:"POST",data:{token:e.settings.api.api_token,data:shopping_carts,voucher_code:voucher_code,method_shipping:method_shipping},dataType:"json",success:function(t){200==t.code?(localStorage.clear(),Swal.fire(check_i18n()?"Order Success!":"\u0110\u1eb7t h\xe0ng th\xe0nh c\xf4ng",check_i18n()?"Order Success!":"Th\xe0nh c\xf4ng","success").then(()=>{window.location=check_i18n()?"/en/users/orders":"/vi/users/orders"})):"negative"==t.message?Swal.fire({icon:"error",title:check_i18n()?"Quantity must be is not negative":"S\u1ed1 l\u01b0\u1ee3ng kh\xf4ng \u0111\u01b0\u1ee3c \xe2m",text:check_i18n()?"We remove your cart, then your order product another again, thank you!":"Ch\xfang t\xf4i g\u1ee1 b\u1ecf gi\u1ecf h\xe0ng c\u1ee7a b\u1ea1n, sau \u0111\xf3 b\u1ea1n \u0111\u1eb7t s\u1ea3n ph\u1ea9m kh\xe1c m\u1ed9t l\u1ea7n n\u1eefa, c\u1ea3m \u01a1n b\u1ea1n!"}).then(()=>{window.localStorage.removeItem("carts"),window.location=check_i18n()?"/en/users/carts":"/vi/users/carts"}):Swal.fire({icon:"error",title:check_i18n()?"Shopping cart is invalid or Out of stock":"Gi\u1ecf h\xe0ng kh\xf4ng h\u1ee3p l\u1ec7 ho\u1eb7c h\u1ebft h\xe0ng",text:check_i18n()?"We remove your cart, then your order product another again, thank you!":"Ch\xfang t\xf4i g\u1ee1 b\u1ecf gi\u1ecf h\xe0ng c\u1ee7a b\u1ea1n, sau \u0111\xf3 b\u1ea1n \u0111\u1eb7t s\u1ea3n ph\u1ea9m kh\xe1c m\u1ed9t l\u1ea7n n\u1eefa, c\u1ea3m \u01a1n b\u1ea1n!"}).then(()=>{window.localStorage.removeItem("carts"),window.location=check_i18n()?"/en/users/carts":"/vi/users/carts"})},error:function(){Swal.fire({icon:"error",title:check_i18n()?"An error occurred, please login again":"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng \u0111\u0103ng nh\u1eadp l\u1ea1i"}).then(()=>{})}})})},e.checkVoucher=function(){shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$(".voucher").off().on("click",function(){voucher_code=$(".voucher_code").val().trim(),$.ajax({url:e.settings.api.voucher,headers:{Authorization:"Bearer "+e.settings.api.api_token},type:"POST",data:{voucher_code:voucher_code},dataType:"json",success:function(t){200==t.code?(Swal.fire({icon:"success",title:"Voucher cost is: $"+t.data.cost,showConfirmButton:!1,timer:2500}),r=parseFloat($("option:selected").text().split("$").pop()),total_payment=parseFloat(r+getTotal())-parseFloat(t.data.cost),$(".totalOrder").get(0).innerText="$"+total_payment):Swal.fire({icon:"error",title:check_i18n()?"Voucher is invalid":"M\xe3 kh\xf4ng h\u1ee3p l\u1ec7",text:check_i18n()?"or expired":"Ho\u1eb7c h\u1ebft h\u1ea1n"})},error:function(){}})})},e.changeMethodShipping=function(){$("select").off().on("change",function(){method_id=this;var t=$("option:selected").text().split("$").pop();$(".totalOrder").get(0).innerText="$"+parseFloat(getTotal()+parseFloat(t)),$(".price_shipping").get(0).innerText="$"+parseFloat($("option:selected").text().split("$").pop())}),e.checkout_with_momo=function(){shopping_carts=localStorage.getItem("carts")?JSON.parse(localStorage.getItem("carts")):[],$(document).on("click",".checkout_with_momo",function(){voucher_code=$(".voucher_code").val().trim(),method_shipping=parseFloat($("option:selected").val()),$.ajax({url:e.settings.api.checkout_with_momo,headers:{Authorization:"Bearer "+e.settings.api.api_token},type:"POST",data:{token:e.settings.api.api_token,data:shopping_carts,voucher_code:voucher_code,method_shipping:method_shipping},dataType:"json",success:function(t){200==t.code?window.location=t.data.url:Swal.fire({icon:"error",title:"error"}).then(()=>{window.localStorage.removeItem("carts"),window.location="/users/carts"})},error:function(){}})})}},e.init=function(){e.addToCart(),e.showCarts(),e.incrementCart(),e.decrementCart(),e.handleQuantityInput(),e.removeCart(),e.showBadegs(),e.addToCartInDetail(),e.checkout(),e.checkVoucher(),e.changeMethodShipping(),e.checkout_with_momo()}}$(document).ready(function(){cart=new Cart,cart.init()});